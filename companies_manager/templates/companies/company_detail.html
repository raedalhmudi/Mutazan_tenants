{% extends "admin/base_site.html" %}

{% block content %}
<style>
    .table-container {
        max-height: 500px;
        overflow-y: auto;
        border: 2px solid #ccc;
        border-radius: 10px;
        background-color: #f9f9f9;
        padding: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    thead {
        position: sticky;
        top: 0;
        background-color: #e0e0e0;
        z-index: 10;
    }
    th, td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: #f1f1f1;
    }
</style>

<div class="container mt-4">
    <h2>{{ company.name }}</h2>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
    <div class="mb-3">
        <h4>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„</h4>
        <button class="btn btn-info" id="daily-report">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</button>
        <button class="btn btn-info" id="weekly-report">ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
        <button class="btn btn-info" id="monthly-report">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
        <button id="print-report" class="btn btn-success">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>

    <!-- Ø­Ù‚ÙˆÙ„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ -->
    <div id="weekly-fields" style="display: none;">
        <label for="from-date">Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="from-date" class="form-control">
        <label for="to-date">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="to-date" class="form-control">
        {% comment %} <button class="btn btn-primary mt-2" id="filter-weekly">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button> {% endcomment %}
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ù‡Ø± Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
    <div id="monthly-fields" style="display: none;">
        <label for="month-select">Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±:</label>
        <select id="month-select" class="form-control">
            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
            <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
            <option value="3">Ù…Ø§Ø±Ø³</option>
            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
            <option value="5">Ù…Ø§ÙŠÙˆ</option>
            <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
            <option value="8">Ø£ØºØ³Ø·Ø³</option>
            <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
            <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
            <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
        {% comment %} <button class="btn btn-primary mt-2" id="filter-monthly">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button> {% endcomment %}
    </div>

    <!-- Ø²Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© -->
    <button id="fetch-data" class="btn btn-primary">ğŸ”„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</button>
    <span id="fetch-status" style="margin-left: 10px; font-weight: bold;"></span>

    <ul class="nav nav-tabs mt-3" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="weight-cards-tab" data-toggle="tab" href="#weight-cards" role="tab" aria-controls="weight-cards" aria-selected="true">Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©</a>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="weight-cards" role="tabpanel" aria-labelledby="weight-cards-tab">
            <table class="table" border="1">
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                        <th>Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙØ§Ø±Øº</th>
                        <th>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø­Ù…Ù„</th>
                        <th>Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØµØ§ÙÙŠ</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    {% for card in transferred_cards %}
                    <tr>
                        <td>{{ card.plate_number }}</td>
                        <td>{{ card.empty_weight }}</td>
                        <td>{{ card.loaded_weight }}</td>
                        <td>{{ card.net_weight }}</td>
                        <td>{{ card.driver_name }}</td>
                        <td>{{ card.entry_date }}</td>
                        <td>{{ card.exit_date }}</td>
                        <td>{{ card.material }}</td>
                        <td>{{ card.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->

</div>

<!-- ÙƒÙˆØ¯ JavaScript Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API -->
<script>
    document.getElementById("fetch-data").addEventListener("click", function() {
        let fetchStatus = document.getElementById("fetch-status");
        fetchStatus.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
    
        let companyId = "{{ company.id }}";  // Ø¬Ù„Ø¨ ID Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨
    
        fetch(`/companies/${companyId}/fetch-data/`)  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ù…Ø¹ ØªÙ…Ø±ÙŠØ± ID
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                fetchStatus.textContent = "âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!";
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                let tableBody = document.getElementById("table-body");
                tableBody.innerHTML = "";  // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                data.cards.forEach(card => {
                    let row = `
                        <tr>
                            <td>${card.plate_number}</td>
                            <td>${card.empty_weight}</td>
                            <td>${card.loaded_weight}</td>
                            <td>${card.net_weight}</td>
                            <td>${card.driver_name}</td>
                            <td>${card.entry_date}</td>
                            <td>${card.exit_date}</td>
                            <td>${card.material}</td>
                            <td>${card.status}</td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            } else {
                fetchStatus.textContent = "âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!";
            }
        })
        .catch(error => {
            fetchStatus.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„!";
            console.error(error);
        });
    });
    document.getElementById("daily-report").addEventListener("click", function() {
        document.getElementById("weekly-fields").style.display = "none";
        document.getElementById("monthly-fields").style.display = "none";
    });
    
    document.getElementById("weekly-report").addEventListener("click", function() {
        document.getElementById("weekly-fields").style.display = "block";
        document.getElementById("monthly-fields").style.display = "none";
    });
    
    document.getElementById("monthly-report").addEventListener("click", function() {
        document.getElementById("weekly-fields").style.display = "none";
        document.getElementById("monthly-fields").style.display = "block";
    });
    
    document.getElementById("print-report").addEventListener("click", function() {
        window.print();
    });
    </script>
    

{% endblock %}